{{define "workorders-bom"}}
<div class="p-6 space-y-4">
  <div class="flex items-center justify-between">
    <h3 class="text-lg font-semibold">BOM for {{.WorkOrder.AssemblyIPN}} (√ó{{.WorkOrder.Qty}})</h3>
    <button onclick="history.back()" class="btn btn-secondary text-sm">‚Üê Back</button>
  </div>
  
  {{if eq (len .BOMLines) 0}}
  <p class="text-gray-400 text-center py-4">No BOM data available</p>
  {{else}}
  <div class="overflow-x-auto">
    <table class="w-full text-sm">
      <thead>
        <tr class="border-b border-gray-200 dark:border-gray-700 text-left">
          <th class="px-3 py-2 font-medium text-gray-500">IPN</th>
          <th class="px-3 py-2 font-medium text-gray-500">Description</th>
          <th class="px-3 py-2 font-medium text-gray-500 text-right">Required</th>
          <th class="px-3 py-2 font-medium text-gray-500 text-right">On Hand</th>
          <th class="px-3 py-2 font-medium text-gray-500 text-right">Shortage</th>
          <th class="px-3 py-2 font-medium text-gray-500 text-center">Status</th>
        </tr>
      </thead>
      <tbody>
        {{range .BOMLines}}
        {{$rowClass := ""}}
        {{if eq .Status "ok"}}{{$rowClass = "bg-green-50 dark:bg-green-900/20"}}{{end}}
        {{if eq .Status "low"}}{{$rowClass = "bg-yellow-50 dark:bg-yellow-900/20"}}{{end}}
        {{if eq .Status "shortage"}}{{$rowClass = "bg-red-50 dark:bg-red-900/20"}}{{end}}
        <tr class="border-b border-gray-100 dark:border-gray-700 {{$rowClass}}">
          <td class="px-3 py-2 font-mono">{{.IPN}}</td>
          <td class="px-3 py-2 text-gray-600">{{.Description}}</td>
          <td class="px-3 py-2 text-right">{{printf "%.0f" .QtyRequired}}</td>
          <td class="px-3 py-2 text-right">{{printf "%.0f" .QtyOnHand}}</td>
          <td class="px-3 py-2 text-right {{if gt .Shortage 0}}text-red-600 font-medium{{end}}">{{printf "%.0f" .Shortage}}</td>
          <td class="px-3 py-2 text-center">
            {{if eq .Status "ok"}}‚úÖ OK{{end}}
            {{if eq .Status "low"}}‚ö†Ô∏è Low{{end}}
            {{if eq .Status "shortage"}}‚ùå Shortage{{end}}
          </td>
        </tr>
        {{end}}
      </tbody>
    </table>
  </div>
  
  {{$hasShortages := false}}
  {{range .BOMLines}}{{if gt .Shortage 0}}{{$hasShortages = true}}{{end}}{{end}}
  {{if $hasShortages}}
  <div class="bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4">
    <h4 class="font-medium text-red-800 dark:text-red-200 mb-2">‚ö†Ô∏è Parts Shortages Detected</h4>
    <p class="text-red-700 dark:text-red-300 text-sm mb-3">This work order cannot be completed due to insufficient inventory.</p>
    <button hx-post="/procurement/generate-from-wo" 
            hx-vals='{"wo_id": "{{.WorkOrder.ID}}"}'
            hx-target="#modal-content" hx-swap="innerHTML"
            class="btn btn-danger">üõí Create PO for Shortages</button>
  </div>
  {{else}}
  <div class="bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg p-4">
    <h4 class="font-medium text-green-800 dark:text-green-200">‚úÖ All Parts Available</h4>
    <p class="text-green-700 dark:text-green-300 text-sm">This work order can be started - all required parts are in stock.</p>
  </div>
  {{end}}
  {{end}}
  
  <div class="flex justify-end">
    <button onclick="document.getElementById('modal').classList.add('hidden')" 
            class="btn btn-secondary">Close</button>
  </div>
</div>
{{end}}